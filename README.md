# Swarmbot

Swarmbot 是一个运行在本地环境中的 **多 Agent 集群智能系统 (Multi-Agent Swarm System)**。它深度整合了 **nanobot**（单体智能与工具能力）、**swarms**（多智能体编排架构）与 **qmd**（三层记忆系统），旨在为本地模型（如 Kimi, vLLM, Ollama）提供强大的任务规划与执行能力。

---

## 🌟 核心架构

Swarmbot 的设计理念是 **"集体智慧 + 长期记忆 + 深度工具集成"**。

### 1. 三位一体组件
*   **Core Agent (Nanobot Inside)**
    *   底层复用 `nanobot` 框架，具备 Gateway（飞书/Slack/Email）、Heartbeat、Skill/Plugin 等原生能力。
    *   通过 `NanobotSkillAdapter`，Swarm 中的 Agent 可以直接调用本地 Python 技能和系统工具。
*   **Swarm Orchestration (Swarms)**
    *   支持多种编排架构：Sequential（顺序）、Concurrent（并发）、Hierarchical（层级）、State Machine（状态机）等。
    *   内置 `AutoSwarmBuilder`，可根据用户任务自动选择最佳架构。
*   **Tri-Layer Memory (QMD)**
    *   **LocalMD (Short-term)**: 本地 Markdown 日志缓存，记录每日会话。
    *   **MemoryMap (Whiteboard)**: 内存中的共享白板，存储任务全局状态与决策快照。
    *   **QMD (Long-term)**: 基于向量 + BM25 的持久化知识库，支持语义检索。

### 2. Long Horizon Middleware
针对复杂长程任务，Swarmbot 引入了 **Long Horizon** 中间件：
*   **Hierarchical Task Graph**: 自动将用户目标分解为有向无环图 (DAG) 任务链。
*   **WorkMap Memory**: 维护“技能地图”，根据子任务需求自动检索最佳 Skill（或决定在线搜索）。
*   **Skill Executor**: 调度 Agent 执行具体子任务，并处理任务间的依赖关系与结果传递。

---

## 🚀 快速开始

### 1. 安装
```bash
# 克隆仓库
git clone https://github.com/your-repo/swarmbot.git
cd swarmbot

# 运行独立环境安装脚本（自动安装 Python 依赖与 npm qmd）
chmod +x scripts/install_deps.sh
./scripts/install_deps.sh

# 初始化配置
swarmbot onboard
```

### 2. 配置模型 (Provider)
Swarmbot 默认不包含任何 API Key，请手动配置 OpenAI 兼容接口（如 Kimi, DeepSeek, Localhost）：

```bash
swarmbot provider add \
  --base-url https://api.moonshot.cn/v1 \
  --api-key YOUR_API_KEY \
  --model kimi-k2-turbo-preview \
  --max-tokens 126000
```

### 3. 运行对话
```bash
# 启动自动模式（推荐）
swarmbot run
```
在此模式下，Swarmbot 会先分析你的任务，自动决定是使用顺序流、层级流还是状态机流。

---

## 📚 进阶使用

### 切换架构
你可以强制指定 Swarm 运行的架构：

```bash
# 启用 Long Horizon 模式（适合复杂规划任务）
swarmbot config --architecture long_horizon

# 启用状态机模式（适合代码 Review 等循环流程）
swarmbot config --architecture state_machine

# 启用并行模式（适合批量处理）
swarmbot config --architecture concurrent
```

### 使用 Nanobot 原生功能
Swarmbot CLI 透传了 nanobot 的所有核心命令：

```bash
# 启动飞书/Slack 网关
swarmbot gateway

# 查看已安装技能
swarmbot skill list

# 执行心跳检测
swarmbot heartbeat
```

### 记忆系统交互
*   **自动记录**：所有对话会自动写入 `workspace/cache/chat_log_YYYY-MM-DD.md`。
*   **知识检索**：Agent 在推理时会根据 `QMDMemory` 提示主动索取知识。你也可以通过 `qmd search` 手动查询。

---

## 🛠️ Long Horizon 工作原理

当你在 `config` 中选择 `long_horizon` 架构，或 AutoSwarmBuilder 自动选择它时，流程如下：

1.  **Plan (规划)**: `HierarchicalTaskGraph` 调用 LLM，将用户输入（如“开发一个贪吃蛇游戏”）拆解为 `[设计结构, 编写核心逻辑, 编写UI, 测试]` 等依赖任务。
2.  **Skill Match (技能匹配)**: `WorkMapMemory` 扫描本地技能库，为每个子任务推荐最佳工具（如 `file_write`, `python_exec`）。
3.  **Execute (执行)**: `SwarmManager` 按照 DAG 拓扑顺序调度 Agent，将前置任务的结果（Context）和推荐技能注入 Prompt，Agent 执行并产出结果。
4.  **Loop (循环)**: 直到所有任务状态变为 `completed`。

---

## License
MIT

---

**Acknowledgement**: All code generated by Trae & Tomoko.
